<!DOCTYPE html>
<html>

<head>
  <title>Studious - Authentication</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css">
  <style>

  </style>
  
</head>

<body>
  <h1 id="welcome-message"></h1>

  
  <div id="bodyContainer" class="container-fluid" class="container-sm" class="container-md" class="container-lg">
    <div class="row">
      <div class="col" id="leftContent">
        <h4 class="chat-history-title">Chat History</h4>
        <div id="chatHistory" class="chat-history">
          <!-- chat history items will be dynamically injected here -->
        </div>
      </div>
      <div class="col-6" id="mainContent">
        <div style="text-align: center; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center;">

        <!-- AI Wizard SVG -->
        <div style="margin-bottom: 20px;">
          <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <!-- Gradient definitions -->
              <linearGradient id="wizardHat" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#764ba2;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#f093fb;stop-opacity:1" />
              </linearGradient>
              <linearGradient id="wizardRobe" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
              </linearGradient>
              <linearGradient id="magicWand" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#ffecd2;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#fcb69f;stop-opacity:1" />
              </linearGradient>
              <radialGradient id="magicGlow" cx="50%" cy="50%" r="50%">
                <stop offset="0%" style="stop-color:#fff;stop-opacity:0.8" />
                <stop offset="70%" style="stop-color:#ffd700;stop-opacity:0.4" />
                <stop offset="100%" style="stop-color:#ff6b6b;stop-opacity:0.1" />
              </radialGradient>
            </defs>
            
            <!-- Background glow -->
            <circle cx="60" cy="60" r="55" fill="url(#magicGlow)" opacity="0.3"/>
            
            <!-- Wizard robe -->
            <path d="M60 45 L45 105 L75 105 Z" fill="url(#wizardRobe)" stroke="#2c5aa0" stroke-width="1"/>
            
            <!-- Wizard face -->
            <circle cx="60" cy="35" r="12" fill="#fdbcb4" stroke="#e8a298" stroke-width="1"/>
            
            <!-- Wizard hat -->
            <path d="M60 10 L45 40 L75 40 Z" fill="url(#wizardHat)" stroke="#5a4fcf" stroke-width="1"/>
            <circle cx="52" cy="40" r="3" fill="#fff" opacity="0.8"/>
            <circle cx="68" cy="40" r="2" fill="#fff" opacity="0.6"/>
            
            <!-- Hat tip with star -->
            <circle cx="48" cy="15" r="4" fill="#ffd700"/>
            <path d="M48 12 L49 15 L52 15 L50 17 L51 20 L48 18 L45 20 L46 17 L44 15 L47 15 Z" fill="#fff"/>
            
            <!-- Eyes -->
            <circle cx="56" cy="32" r="1.5" fill="#333"/>
            <circle cx="64" cy="32" r="1.5" fill="#333"/>
            
            <!-- Beard -->
            <path d="M60 40 Q50 45 52 52 Q60 48 68 52 Q70 45 60 40" fill="#e6e6e6" stroke="#ccc" stroke-width="0.5"/>
            
            <!-- Magic wand -->
            <line x1="75" y1="60" x2="95" y2="40" stroke="url(#magicWand)" stroke-width="3" stroke-linecap="round"/>
            
            <!-- Magic sparkles -->
            <circle cx="98" cy="37" r="2" fill="#ffd700" opacity="0.9">
              <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/>
            </circle>
            <circle cx="92" cy="32" r="1.5" fill="#ff6b6b" opacity="0.8">
              <animate attributeName="opacity" values="0.2;0.9;0.2" dur="1.5s" repeatCount="indefinite" begin="0.5s"/>
            </circle>
            <circle cx="102" cy="45" r="1" fill="#4ecdc4" opacity="0.7">
              <animate attributeName="opacity" values="0.1;0.8;0.1" dur="1.8s" repeatCount="indefinite" begin="1s"/>
            </circle>
            
            <!-- Additional floating sparkles -->
            <circle cx="25" cy="30" r="1" fill="#ffd700" opacity="0.6">
              <animate attributeName="opacity" values="0;0.8;0" dur="3s" repeatCount="indefinite"/>
              <animateTransform attributeName="transform" type="translate" values="0,0; 5,-10; 0,0" dur="3s" repeatCount="indefinite"/>
            </circle>
            <circle cx="85" cy="80" r="1.5" fill="#ff6b6b" opacity="0.5">
              <animate attributeName="opacity" values="0;0.7;0" dur="2.5s" repeatCount="indefinite" begin="1s"/>
              <animateTransform attributeName="transform" type="translate" values="0,0; -8,-15; 0,0" dur="2.5s" repeatCount="indefinite" begin="1s"/>
            </circle>
          </svg>
            <div id="subjectTitle">Ask a studious question</div>>
        </div>

        <!-- <p>Type your question below and click submit to get an answer from our AI assistant.</p> -->
        <div class="container-sm" ; class="container-md" ; class="container-lg" >
        <table style="margin: 0 auto; text-align: center; border-collapse: separate; border: 1px solid gray; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
          <tr>
            <td style="text-align: center; padding: 10px;">
              <input type="text" id="user-input" class="flex input" class="container-lg" class="container-md" class="container-sm"style="text-align: center; padding: 8px; margin-top: 25px; width: 400px;" placeholder="Enter your question here" required/>
            </td>
            <td style="text-align: center; padding: 10px;">
              <button id="submit-btn" onclick="submitQuestion()" style="padding: 8px 16px;" class="btn btn-primary">Submit</button>
            </td>
          </tr>
          <tr>
            <td>
              <p class="text-muted" style="font-size: 0.9em;">(e.g., "What is the capital of France?")</p>
            </td>
          </tr>
          <tr>
            <td colspan="2" style="padding: 10px;">
              
            </td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: center; padding: 10px;">
            
            </td>
          </tr>
        </table>
        </div>
        </div>

        <div id="thinking-container" style="text-align: center; display: none;">
          <div id="thinking-svg">
            <!-- svg with magic wand sparkling animation -->
          <svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <!-- Background for contrast -->
        <rect width="100%" height="100%" fill="transparent" />

        <!-- Wand (rotated rectangle) -->
        <rect x="95" y="70" width="10" height="80" rx="2" ry="2" fill="#4B4B4B" transform="rotate(-45 100 110)" />

        <!-- Magic star at the wand tip -->
        <g transform="translate(100,70)">
          <g>
            <polygon id="star" points="0,-10 2.5,-3.5 10,-3.5 4,1 6,8 -0.5,4 -6,8 -4,1 -10,-3.5 -2.5,-3.5"
              fill="#FFD700" stroke="#FFFACD" stroke-width="0.5">
              <animateTransform attributeName="transform" type="rotate" values="0;360" dur="2s" repeatCount="indefinite" />
            </polygon>
          </g>
        </g>

        <!-- Sparkles (animated glowing circles) -->
        <circle cx="50" cy="50" r="3" fill="#FFD700">
          <animate attributeName="r" values="3;6;3" dur="1.2s" repeatCount="indefinite" />
          <animate attributeName="opacity" values="1;0.3;1" dur="1.2s" repeatCount="indefinite" />
        </circle>

        <circle cx="160" cy="40" r="2.5" fill="#FFD700">
          <animate attributeName="r" values="2.5;5;2.5" dur="1.5s" repeatCount="indefinite" />
          <animate attributeName="opacity" values="1;0.2;1" dur="1.5s" repeatCount="indefinite" />
        </circle>

        <circle cx="140" cy="120" r="2.8" fill="#FFD700">
          <animate attributeName="r" values="2.8;5.5;2.8" dur="1.7s" repeatCount="indefinite" />
          <animate attributeName="opacity" values="1;0.4;1" dur="1.7s" repeatCount="indefinite" />
        </circle>

        <circle cx="70" cy="160" r="3" fill="#FFD700">
          <animate attributeName="r" values="3;6;3" dur="1.4s" repeatCount="indefinite" />
          <animate attributeName="opacity" values="1;0.3;1" dur="1.4s" repeatCount="indefinite" />
        </circle>
      </svg>

                <span id="thinking-message" class="text-muted">Thinking...</span>
            </div>
        </div>

        <div id="response-container" style="
                margin: 10px; 
                min-height: 100px; 
                display: flex;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                padding: 15px;
                background-color: #f9f9f9;
                word-wrap: break-word;
                overflow-wrap: break-word;
                display: none;
              ">
        </div>
        <div id="usage-div" style="
                color: brown; 
                max-width: 400px; 
                display: none;
                text-align: left;
                margin-left: auto; 
                margin-right: auto;">
                <p>OpenAI API Usage Details</p>
                <textarea id="usage-message" rows="15" cols="200" style="color: brown; max-width: 400px;"></textarea>
        </div>
      </div>
      <div class="col" id="rightContent">
        <div id="suggestedQuestions" class="container-sm" class="container-md" class="container-lg">
          <h2>Suggested Questions</h2>
          <div id="suggestedQuestionsDiv" class="list-group list-group-numbered"></div>
          <!-- <ul class="list-group">
            <li class="list-group-item" onclick="setQuestion('What is the capital of France?')">What is the capital of France?</li>
            <li class="list-group-item" onclick="setQuestion('How does photosynthesis work  ?')">How does photosynthesis work?</li>
            <li class="list-group-item" onclick="setQuestion('What is the theory of relativity?')">What is the theory of relativity?</li>
            <li class="list-group-item" onclick="setQuestion('Explain the Pythagorean theorem.')">Explain the Pythagorean theorem.</li>
            <li class="list-group-item" onclick="setQuestion('What are the laws of thermodynamics?')">What are the laws of thermodynamics?</li>
          </ul> -->
        </div>
    </div>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Check if user is logged in
      console.log("Checking login status for fetching the topics");
      const isLoggedIn = localStorage.getItem("isLoggedIn") || sessionStorage.getItem("isLoggedIn");
      if (isLoggedIn === "true") {
        fetch("/topics")
        .then(response => response.json())
        .then(data => {
          console.log("Topics fetched successfully:", data);
          const topics = data.topics.sort((a, b) => a.displayOrder - b.displayOrder); 

          console.log("total topics fetched: " + topics.length);

          if (topics && topics.length > 0) {

            // get the parent dropdown for ALL the Topics
            const topicsContainer = document.getElementById("topicsContainer");

            topics.forEach(topic => {
              
              const topicDiv = document.createElement("div");
              topicDiv.className = "dropdown";

              const topicButton = document.createElement("button");
              topicButton.className = "btn btn-primary dropdown-toggle w-100";
              topicButton.type = "button";
              topicButton.id = "dropdownMenu" + topic.displayOrder;
              topicButton.setAttribute("data-bs-toggle", "dropdown");
              topicButton.setAttribute("aria-expanded", "false");
              topicButton.textContent = topic.name;
              topicDiv.appendChild(topicButton);

              const subTopicList = document.createElement("ul");
              subTopicList.className = "dropdown-menu w-100";
              subTopicList.setAttribute("aria-labelledby", "dropdownMenu" + topic.displayOrder);

              var subTopics = topic.subtopics.sort((a, b) => a.displayOrder - b.displayOrder); // Sort subtopics by displayOrder
              console.log("Subtopics for " + topic.name + ": " + subTopics.length);

              subTopics.forEach(subTopic => {
                const subListItem = document.createElement("li");
                
                const subTopicLink = document.createElement("a");
                subTopicLink.id = "subTopicLink-" + subTopic.name + "-" + subTopic.displayOrder;
                subTopicLink.className = "dropdown-item";
                subTopicLink.href = "#";
                subTopicLink.setAttribute("title", subTopic.description);
                subTopicLink.textContent = subTopic.name;
                subTopicLink.onclick = function() {
                  console.log("Sub Topic Clicked: " + subTopic.name);
                  
                  // Update the title
                  const subjectTitle = document.getElementById('subjectTitle');
                  subjectTitle.textContent = "Ask a " + subTopic.name + " question";
                  subjectTitle.style.display = "block";

                  // Set suggested questions
                  setSuggestedQuestions(subTopic.suggestedQuestions);
                };

                subListItem.appendChild(subTopicLink);

                subTopicList.appendChild(subListItem);
              });
              
              topicDiv.appendChild(subTopicList);
             
              console.log("Added topic: " + topic.name + " with " + topic.subtopics.length + " subtopics");
            });
            
          } else {
            console.log("No topics available.");
          }
        })
      } else {
        console.log("User is not logged in. Redirecting to login page.");
        // window.location.href = "signup.html"; // Redirect to signup page if not logged in
      }
    });

    function setSuggestedQuestions(questions) {
      console.log("Suggested Questions: " + JSON.stringify(questions));
      const questionsDiv = document.getElementById("suggestedQuestionsDiv");
      questionsDiv.innerHTML = "";

      // <ul> </ul>
      const questionsList = document.createElement("ul");
      questionsList.className = "list-group";
      questionsDiv.appendChild(questionsList);

      questions.forEach(question => {
   
        // <li> </li>
        const questionListItem = document.createElement("li");
        questionListItem.className = "list-group-item";

        // <a> </a>
        const questionLink = document.createElement("a");
        questionLink.href = "#";
        questionLink.setAttribute("title", question);
        questionLink.textContent = question;
        questionLink.onclick = function() {
          setQuestion(question);
        };
        
        // <li> <a> </a> </li>
        questionListItem.appendChild(questionLink);
        
        // <ul>  <li> <a> </a> </li> </ul>
        questionsList.appendChild(questionListItem);
      });

    }
    
    function setQuestion(question) {
        console.log("Question selected: " + question);
        const userInput = document.getElementById("user-input");
        userInput.value = question; // Set the input field to the selected question
    }

    let subjectTitle = document.getElementById('studiousTitle');

    // subjectTitle.textContent = "Ask a" + subtopic + " question";
    // subjectTitle.style.display = "block";
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <script src="/js/navbar.js"></script>
  
  <script src="/js/home.js"></script>
</body>
</html>
